<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />

	<!--Safari Web App-->

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="apple-mobile-web-app-title" content="Order Form">
	<link rel="apple-touch-icon" href="images/single-page-icon.png">

	<meta name="mobile-web-app-capable" content="yes">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<title>Order Form</title>
	<link rel="stylesheet" href="css/auselec.css">
</head>

<body id='body' ontouchstart="">

	<div id="display-install">
		<div class="install-content">
			<div class="install-head">
				<div class="install-img">
					<img src="images/austin-outline.svg">
				</div>
				<div class="install-title">Order Form</div>
			</div>
			<div class="install-dialog">
				<div class="install-text">To install, tap<div class="install-icon-addtohome"></div>and choose</div><br>Add to
				Home Screen
				<div class="install-pointer">
				</div>
			</div>
		</div>
	</div>

	<div id="display-load">
		<div class="load-box">
			<img class="load-svg" src="images/austin-icon.svg" alt="Austin Electric, Inc.">
		</div>
	</div>

	<div class="display-screen">
		<div class="display-order">
			<button onclick="location.reload()">Reload</button>
			<div class="font">Austin Electric, Inc.</div>
			<form onsubmit="submitForm(event)">
				<input name="data" type="text">
				<button type="submit">test</button>
				<canvas id="sign"></canvas>
			</form>
		</div>
	</div>

	<div class="display-print"></div>

	<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
	<script>

		G = {
			'hidden': '',
			'visibilitychange': ''
		}

		if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support
			G.hidden = "hidden";
			G.visibilityChange = "visibilitychange";
		} else if (typeof document.msHidden !== "undefined") {
			G.hidden = "msHidden";
			G.visibilityChange = "msvisibilitychange";
		} else if (typeof document.webkitHidden !== "undefined") {
			G.hidden = "webkitHidden";
			G.visibilityChange = "webkitvisibilitychange";
		}
		document.addEventListener(G.visibilityChange, () => {
			if (!document[G.hidden]) {
				location.reload();
			}
		});

		window.onload = () => {
			logger('Snapshot 1vz.6 test');
			if (navigator.standalone) {
				if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support
					G.hidden = "hidden";
					G.visibilityChange = "visibilitychange";
				} else if (typeof document.msHidden !== "undefined") {
					G.hidden = "msHidden";
					G.visibilityChange = "msvisibilitychange";
				} else if (typeof document.webkitHidden !== "undefined") {
					G.hidden = "webkitHidden";
					G.visibilityChange = "webkitvisibilitychange";
				}
				document.addEventListener(G.visibilityChange, () => {
					if (!document[G.hidden]) {
						location.reload();
					}
				});
				BuildApp().then(() => {
					document.getElementById('display-load').classList.add('load-remove');
				});
			}
			else {
				document.getElementById('display-load').children[0].style['-webkit-filter'] = 'blur(10px)';
				document.getElementById('display-install').style.display = 'block';
				if (navigator.onLine && isIosSafari()) { }
				else if (!navigator.onLine) {
					console.log(navigator.onLine);
					document.getElementById('display-install').firstElementChild.innerHTML = 'Please connect to the internet for an up-to-date and stable installation.';
				}
				else {
					document.getElementById('display-install').firstElementChild.innerHTML = 'This App may not be compatible for your device.';
				}
			}

			logger(navigator.standalone);
			// logger(location);
			console.log('ran');
			NodeList.prototype.forEach = Array.prototype.forEach;
			canvas = document.getElementById('sign');
			signaturePad = new SignaturePad(canvas);
		}

		function BuildApp() {
			return new Promise((resolve, reject) => {
				RegisterSW();
				resolve();
			});
		}

		function isIosSafari() {
			var isTrue = true;
			nav = window.navigator;
			['iPhone', 'iPad', 'iPod'].forEach((device) => {
				isTrue = (isTrue && 'standalone' in nav
					&& nav.userAgent.indexOf(device) != -1
					&& nav.userAgent.indexOf('Mac OS') != -1
					&& nav.userAgent.indexOf('Safari') != -1
					&& nav.userAgent.indexOf(device) != -1);
			});
			return isTrue;
		}

		function RegisterSW() {
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/dev/auselec-sw.js').then((registration) => {
					// Registration was successful
					logger('SW Worked');
					console.log('ServiceWorker registration successful with scope: ', registration.scope);
				}, (err) => {
					// registration failed :(
					logger('SW err');
					console.log('ServiceWorker registration failed: ', err);
				});
			}
			else {
				logger('No SW');
			}
		}

		function getFile() {
			try {
				logger('ran');
				data = document.getElementById('data');
				logger(data.value);
				data = data.value.split('');
				logger(data);
				data = data.map((letter) => {
					return letter.charCodeAt(0);
				});
				logger(data);
				data = data.join(' ');
				logger(data);
				a = window.btoa(data);
				logger(a);
				document.body.innerHTML = '';
				document.body.innerText = 'AustinElectric/' + a;
			}
			catch (err) {
				logger(err);
			}
		}

		function submitForm(event) {
			event.preventDefault();
			event.target.childNodes.forEach((cur) => {
				try {
					if (!form_data) {
						form_data = {};
					}
				}
				catch (e) {
					form_data = {};
				}
				if (cur.name) {
					form_data[cur.name] = cur.value;
				}
			});
			console.log(form_data);
		}

		function logger(log) {
			log = JSON.stringify(log);
			div = document.createElement('div');
			div.innerText = log;
			document.body.appendChild(div);
		}

	</script>

</body>

</html>