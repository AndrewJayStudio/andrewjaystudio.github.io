<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />

	<!--Safari Web App-->

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="apple-mobile-web-app-title" content="Order Form">
	<link rel="apple-touch-icon" href="images/single-page-icon.png">

	<meta name="mobile-web-app-capable" content="yes">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<title>Order Form</title>
	<link rel="stylesheet" href="css/auselec.css">
</head>

<body id='body' ontouchstart="">

	<div id="dev">
		<button onclick="console.log(event.target.parentNode.style.display='none')">close
			dev</button>
	</div>

	<div id="display-install">
		<div class="install-content">
			<div class="install-head">
				<div class="install-img">
					<img src="images/austin-outline.svg">
				</div>
				<div class="install-title">Order Form</div>
			</div>
			<div class="install-dialog">
				<div class="install-text">To install, tap<div class="install-icon-addtohome"></div>and choose</div><br>Add to
				Home Screen
				<div class="install-pointer">
				</div>
			</div>
		</div>
	</div>

	<div id="display-load">
		<div class="load-box">
			<img class="load-svg" src="images/austin-icon.svg" alt="Austin Electric, Inc.">
		</div>
	</div>

	<div class="display-screen">
		<div class="screen-order">
			<div class="screen-header">
				<div class="header-left">
					<div class="menu-button" onclick="openMenu()"></div>
					<div class="comp-icon"></div>
					<h1 class="title">Order Form</h1>
				</div>
				<div class="reload-button" tabindex="-1" onclick="toReload()"></div>
			</div>
			<div class="screen-box">
				<div id="screen-content" class="page1">
					<div class="page">
						<div class="page-neworder">
							new order
							<ul>
								<li>Order Form</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<input type="text">
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
							</ul>
						</div>
					</div>
					<div class="page">
						<div class="page-recent">
							<ul>
								<li>No Recent Order Forms</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
								<li>stuff</li>
							</ul>
						</div>
						<div class="page-recent-addbtn">
						</div>
					</div>
					<div class="page page-settings">settings</div>
				</div>
			</div>
			<form style="display: none" onsubmit="submitForm(event)">
				<input name="data" type="text">
				<button type="submit">test</button>
				<canvas id="sign"></canvas>
			</form>
		</div>
		<div id="screen-menu" class="menu-close">
			<div class="menu-items">
				<div class="menu-head" onclick="closeMenu()">
					<div class="header-left">
						<div class="comp-icon"></div>
						<h1 class="title">Order Form</h1>
					</div>
				</div>
				<ul>
					<li onclick="goToPage(0)">
						<div class="mnu-btn-new"></div>
						New Order Form
					</li>
					<li onclick="goToPage(1)">
						<div class="mnu-btn-recent"></div>
						Recent Orders
					</li>
					<li onclick="goToPage(2)">
						<div class="mnu-btn-set"></div>
						Settings
					</li>
				</ul>
			</div>
			<div class="menu-back-dim" onclick="closeMenu()"></div>
		</div>
	</div>

	<div class="display-print"></div>

	<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
	<script>

		G = {
			'hidden': '',
			'visibilitychange': ''
		}

		var contentTouch = {
		};

		if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support
			G.hidden = "hidden";
			G.visibilityChange = "visibilitychange";
		} else if (typeof document.msHidden !== "undefined") {
			G.hidden = "msHidden";
			G.visibilityChange = "msvisibilitychange";
		} else if (typeof document.webkitHidden !== "undefined") {
			G.hidden = "webkitHidden";
			G.visibilityChange = "webkitvisibilitychange";
		}
		document.addEventListener(G.visibilityChange, () => {
			if (!document[G.hidden]) {
				location.reload();
			}
		});

		window.onload = () => {
			logger('menu width');
			if (navigator.standalone || true) {
				if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support
					G.hidden = "hidden";
					G.visibilityChange = "visibilitychange";
				} else if (typeof document.msHidden !== "undefined") {
					G.hidden = "msHidden";
					G.visibilityChange = "msvisibilitychange";
				} else if (typeof document.webkitHidden !== "undefined") {
					G.hidden = "webkitHidden";
					G.visibilityChange = "webkitvisibilitychange";
				}
				document.addEventListener(G.visibilityChange, () => {
					if (!document[G.hidden]) {
						location.reload();
					}
				});
				BuildApp().then(() => {
					document.getElementById('display-load').classList.add('load-remove');
				});
			}
			else {
				document.getElementById('display-load').children[0].style['-webkit-filter'] = 'blur(10px)';
				document.getElementById('display-install').style.display = 'block';
				if (navigator.onLine && isIosSafari()) { }
				else if (!navigator.onLine) {
					console.log(navigator.onLine);
					document.getElementById('display-install').firstElementChild.innerHTML = 'Please connect to the internet for an up-to-date and stable installation.';
				}
				else {
					document.getElementById('display-install').firstElementChild.innerHTML = 'This App may not be compatible for your device.';
				}
			}

			logger(navigator.standalone);
			// logger(location);
			NodeList.prototype.forEach = Array.prototype.forEach;
			canvas = document.getElementById('sign');
			signaturePad = new SignaturePad(canvas);

			// document.body.addEventListener('touchmove', stopBodyOverscroll);

			document.getElementById('screen-content').addEventListener('touchstart', quickMenuStart);
			document.getElementById('screen-content').addEventListener('touchmove', quickMenuMove);
			document.getElementById('screen-content').addEventListener('touchend', quickMenuEnd);
			document.querySelector('.page-neworder').onscroll = () => {
				if (document.querySelector('.page-neworder').scrollTop > 91) {
					hideHeader(true);
				}
				else {
					hideHeader(false);
				}
			};
		}

		function BuildApp() {
			return new Promise((resolve, reject) => {
				RegisterSW();
				resolve();
			});
		}

		function isIosSafari() {
			nav = window.navigator;
			logger(nav.userAgent);
			yes = false;
			['iPhone', 'iPad', 'iPod'].forEach((device) => {
				isTrue = ('standalone' in nav
					&& nav.userAgent.indexOf(device) != -1
					&& nav.userAgent.indexOf('Mac OS') != -1
					&& nav.userAgent.indexOf('Safari') != -1
					&& nav.userAgent.indexOf('CriOS') == -1);
				if (isTrue) {
					yes = true;
				}
			});
			logger(yes);
			return yes;
		}

		function RegisterSW() {
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/dev/auselec-sw.js').then((registration) => {
					// Registration was successful
					logger('SW Worked');
					console.log('ServiceWorker registration successful with scope: ', registration.scope);
				}, (err) => {
					// registration failed :(
					logger('SW err');
					console.log('ServiceWorker registration failed: ', err);
				});
			}
			else {
				logger('No SW');
			}
		}

		function toReload() {
			setTimeout(() => { location.reload() }, 400);
		}

		function openMenu() {
			document.getElementById('screen-menu').classList.add('menu-open');
		}

		function closeMenu() {
			document.getElementById('screen-menu').classList.remove('menu-open');
		}

		function goToPage(num) {
			hideHeader(false);
			closeMenu();
			document.getElementById('screen-content').className = `page${num}`;
			document.activeElement.blur();
		}

		function quickMenuStart(event) {
			contentTouch.start = true;
			contentTouch.move = document.getElementById('screen-content').offsetLeft - event.touches[0].clientX;
			contentTouch.startpos = event.touches[0].clientX;
		}

		// function stopBodyOverscroll(event) {
		// 	event.preventDefault();
		// }

		function quickMenuMove(event) {
			document.getElementById('screen-content').style.transition = 'auto';
			//event.preventDefault();
			if (contentTouch.start) {
				contentTouch.pos = event.touches[0].clientX;
			}
			left = contentTouch.pos + contentTouch.move;
			if (Math.abs(contentTouch.startpos - contentTouch.pos) > 75) {
				contentTouch.horiz = true;
			}
			if (contentTouch.horiz) {
				document.getElementById('screen-content').style.left = (left) + 'px';
			}
		}

		function quickMenuEnd(event) {
			document.getElementById('screen-content').style.transition = '';
			contentTouch = {
			};
			left = parseInt(document.getElementById('screen-content').style.left);
			if (left > (-0.5 * window.innerWidth)) {
				goToPage(0);
			}
			if ((-0.5 * window.innerWidth) > left && left > (-1.5 * window.innerWidth)) {
				goToPage(1);
			}
			if ((-1.5 * window.innerWidth) > left) {
				goToPage(2);
			}
			document.getElementById('screen-content').style.left = '';
		}

		function hideHeader(t_f) {
			if (t_f) {
				console.log('idk');
				document.querySelector('.screen-header').style.top = '-91px';
				document.querySelector('.screen-box').style['padding-top'] = '0px';
				document.getElementById('screen-content').style['max-height'] = '100vh';
			}
			else {
				document.querySelector('.screen-header').style.top = '';
				document.querySelector('.screen-box').style['padding-top'] = '';
				document.getElementById('screen-content').style['max-height'] = '';
			}
		}


		function getFile() {
			try {
				logger('ran');
				data = document.getElementById('data');
				logger(data.value);
				data = data.value.split('');
				logger(data);
				data = data.map((letter) => {
					return letter.charCodeAt(0);
				});
				logger(data);
				data = data.join(' ');
				logger(data);
				a = window.btoa(data);
				logger(a);
				document.body.innerHTML = '';
				document.body.innerText = 'AustinElectric/' + a;
			}
			catch (err) {
				logger(err);
			}
		}

		function submitForm(event) {
			event.preventDefault();
			event.target.childNodes.forEach((cur) => {
				try {
					if (!form_data) {
						form_data = {};
					}
				}
				catch (e) {
					form_data = {};
				}
				if (cur.name) {
					form_data[cur.name] = cur.value;
				}
			});
			console.log(form_data);
		}

		function logger(log) {
			log = JSON.stringify(log);
			div = document.createElement('div');
			div.innerText = log;
			document.getElementById('dev').appendChild(div);
			document.getElementById('dev').style.display = 'block';
		}

	</script>

</body>

</html>